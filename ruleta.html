<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ruleta de Emociones</title>
<style>
  :root {
    --container-w: 90vw;
    --container-max: 520px;
  }

  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: white;
    color: black;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
  }

  #container {
    position: relative;
    width: var(--container-w);
    max-width: var(--container-max);
    aspect-ratio: 1 / 1; /* mantiene forma perfectamente circular */
  }

  #ruleta {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    touch-action: none;
  }

  /* ‚úÖ Flecha centrada justo en el eje de la ruleta */
  .flecha {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(0deg);
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 40px solid black;
    z-index: 20;
    pointer-events: none;
  }

  .boton-girar {
    position: absolute;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50%;
    width: 70px;
    height: 70px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    z-index: 30;
  }

  .boton-instrucciones,
  .boton-volver {
    position: absolute;
    bottom: -12%;
    z-index: 30;
    background: #3498db;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
  }

  .boton-instrucciones { left: 6%; }
  .boton-volver { right: 6%; }

  /* üì± M√≥viles vertical */
  @media (max-width: 768px) and (orientation: portrait) {
    .boton-girar {
      top: -12%;
      left: 50%;
      transform: translateX(-50%);
      width: 65px;
      height: 65px;
    }
  }

  /* üì± M√≥viles horizontales */
  @media (max-width: 1024px) and (orientation: landscape) {
    .boton-girar {
      top: 5%;
      left: 5%;
      transform: none;
      width: 60px;
      height: 60px;
    }
  }

  /* üñ•Ô∏è PC */
  @media (min-width: 1025px) {
    .boton-girar {
      top: -14%;
      left: 10%;
    }
  }

  #modal {
    display: none;
    justify-content: center;
    align-items: center;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 100;
  }

  #cerrar {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
  }

  #imagenAmpliada {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
  }
</style>
</head>
<body>
  <div id="container">
    <canvas id="ruleta" width="500" height="500"></canvas>
    <div class="flecha"></div>

    <button class="boton-girar" id="btnGirar">Girar</button>
    <button class="boton-instrucciones" id="btnInstrucciones">Instrucciones</button>
    <button class="boton-volver" id="btnVolver">Inicio</button>
  </div>

  <div id="modal">
    <span id="cerrar">&times;</span>
    <img id="imagenAmpliada" src="Instrucciones.png" alt="Instrucciones ampliadas" />
  </div>

<script>
/* === L√≥gica original intacta === */
const canvas = document.getElementById('ruleta');
const ctx = canvas.getContext('2d');
const img = new Image();
img.src = 'ruleta.png';
let rotation = 0, spinning = false, velocity = 0, lastSegment = -1;
img.onload = () => drawRoulette();

function drawRoulette(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);
  ctx.rotate(rotation);
  ctx.drawImage(img,-canvas.width/2,-canvas.height/2,canvas.width,canvas.height);
  ctx.restore();
}

/* Bot√≥n Girar */
const btnGirar = document.getElementById('btnGirar');
btnGirar.addEventListener('click', () => {
  if(spinning) return;
  spinning = true;
  let baseVelocity = Math.random() * 1.2 + 0.3;
  if(Math.random() < 0.25) baseVelocity += Math.random()*2 + 1;
  velocity = baseVelocity;
  const segmentos = 8;
  let segment;
  do { segment = Math.floor(Math.random() * segmentos); }
  while(segment === lastSegment);
  lastSegment = segment;

  function animateSpin(){
    if(!spinning) return;
    rotation += velocity;
    velocity *= 0.985;
    if(velocity < 0.002){
      spinning = false;
      velocity = 0;
      drawRoulette();
      return;
    }
    drawRoulette();
    requestAnimationFrame(animateSpin);
  }
  animateSpin();
});

/* Modal de instrucciones */
const modal = document.getElementById('modal');
document.getElementById('btnInstrucciones').addEventListener('click', () => modal.style.display = 'flex');
document.getElementById('cerrar').onclick = () => modal.style.display = 'none';
window.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };

/* Bot√≥n volver */
document.getElementById('btnVolver').addEventListener('click', () => {
  window.location.href = 'index.html';
});

/* Giro manual sin impulso */
let isDragging = false, lastX = 0, lastRotation = 0;
canvas.addEventListener('pointerdown', e => {
  if (spinning) return;
  isDragging = true;
  lastX = e.clientX;
  lastRotation = rotation;
  canvas.setPointerCapture(e.pointerId);
});
canvas.addEventListener('pointermove', e => {
  if (!isDragging) return;
  const delta = (e.clientX - lastX) / 100;
  rotation = lastRotation + delta;
  drawRoulette();
});
canvas.addEventListener('pointerup', () => { isDragging = false; });
window.addEventListener('resize', drawRoulette);
</script>
</body>
</html>
