<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ruleta de Emociones</title>
<style>
  /* --- Layout base --- */
  :root{
    --container-w: 90vw;
    --container-max: 520px;
  }
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background: white;
    color: black;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    overflow:hidden;
  }

  /* Contenedor con ratio 1:1 para mantener la ruleta perfectamente redonda */
  #container{
    position:relative;
    width:var(--container-w);
    max-width:var(--container-max);
    aspect-ratio: 1 / 1;       /* fuerza cuadro cuadrado */
    box-sizing: border-box;
  }

  /* Canvas ocupa totalmente el área del contenedor (siempre cuadrado) */
  #ruleta{
    display:block;
    width:100%;
    height:100%;
    border-radius:50%;
    box-sizing:border-box;
    touch-action:none;
  }

  /* Flecha centrada justo encima del eje superior interior de la ruleta */
  .flecha{
    position:absolute;
    left:50%;
    top:6%;                    /* dentro del contenedor, ligeramente abajo del borde superior para quedar sobre la rueda */
    transform:translateX(-50%) translateY(-50%);
    width:0;
    height:0;
    z-index:20;
    /* tamaño proporcional */
    border-left: calc(6% ) solid transparent;
    border-right: calc(6% ) solid transparent;
    border-bottom: calc(12% ) solid black;
  }

  /* Botones: colocados siempre fuera del círculo (empujados hacia afuera con % negativos) */
  .boton-girar{
    position:absolute;
    top: -12%;                 /* fuera, por arriba del contenedor */
    left: 6%;
    width: 82px;
    height: 82px;
    min-width:56px;
    min-height:56px;
    border-radius:50%;
    background:#e74c3c;
    color:white;
    border:none;
    z-index:30;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
  }

  .boton-instrucciones{
    position:absolute;
    bottom:-10%;               /* fuera, por debajo del contenedor */
    left:6%;
    z-index:30;
    background:#28a745;
    color:white;
    border:none;
    padding:10px 16px;
    border-radius:8px;
    cursor:pointer;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  }

  .boton-volver{
    position:absolute;
    bottom:-10%;               /* fuera, por debajo del contenedor */
    right:6%;
    z-index:30;
    background:#3498db;
    color:white;
    border:none;
    padding:10px 16px;
    border-radius:8px;
    cursor:pointer;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  }

  /* --- Responsive tweaks --- */
  /* Móviles verticales: botón Girar arriba, centrado y fuera del círculo */
  @media (max-width:768px) and (orientation:portrait){
    :root{ --container-w: 92vw; --container-max: 420px; }
    .flecha{
      top:7%;
      border-left: calc(8% ) solid transparent;
      border-right: calc(8% ) solid transparent;
      border-bottom: calc(14% ) solid black;
    }
    .boton-girar{
      top: -14%;
      left: 50%;
      transform: translateX(-50%);
      width:76px;
      height:76px;
    }
    .boton-instrucciones{ bottom:-12%; left:6%; }
    .boton-volver{ bottom:-12%; right:6%; }
  }

  /* Móviles horizontales: botón Girar en esquina superior izquierda (fuera) */
  @media (max-width:1024px) and (orientation:landscape){
    :root{ --container-w: 72vw; --container-max: 520px; }
    .flecha{
      top:5%;
      border-left: calc(6% ) solid transparent;
      border-right: calc(6% ) solid transparent;
      border-bottom: calc(12% ) solid black;
    }
    .boton-girar{
      top:5%;
      left:5%;
      transform:none;
      width:64px;
      height:64px;
    }
    .boton-instrucciones{ bottom:-9%; left:5%; }
    .boton-volver{ bottom:-9%; right:5%; }
  }

  /* Extra small devices */
  @media (max-width:360px){
    .boton-girar{ width:64px;height:64px; top:-16%; }
    .boton-instrucciones, .boton-volver{ padding:8px 12px; font-size:0.9em; bottom:-14%; }
  }
</style>
</head>
<body>

  <div id="container">
    <canvas id="ruleta" width="500" height="500"></canvas>
    <div class="flecha"></div>

    <button class="boton-girar" id="btnGirar">Girar</button>
    <button class="boton-instrucciones" id="btnInstrucciones">Instrucciones</button>
    <button class="boton-volver" id="btnVolver">Inicio</button>
  </div>

  <div id="modal" class="modal" style="display:flex;">
    <span id="cerrar" class="cerrar" style="cursor:pointer;">&times;</span>
    <img id="imagenAmpliada" src="Instrucciones.png" alt="Instrucciones ampliadas" style="max-width:90%; max-height:90%; border-radius:10px;">
  </div>

<script>
/* --- Mantengo exactamente tu lógica JS, solo enlazo elementos --- */

/* Ruleta funcional */
const canvas = document.getElementById('ruleta');
const ctx = canvas.getContext('2d');
const img = new Image();
img.src = 'ruleta.png';
let rotation = 0, spinning = false, velocity = 0, lastSegment = -1;
img.onload = () => drawRoulette();

function drawRoulette(){
  // Dibuja usando el tamaño del canvas real (500x500) - canvas escala visualmente por CSS
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);
  ctx.rotate(rotation);
  ctx.drawImage(img,-canvas.width/2,-canvas.height/2,canvas.width,canvas.height);
  ctx.restore();
}

/* Boton girar */
const btnGirar = document.getElementById('btnGirar');
btnGirar.addEventListener('click', () => {
  if(spinning) return;
  spinning = true;
  let baseVelocity = Math.random() * 1.2 + 0.3;
  if(Math.random() < 0.25) baseVelocity += Math.random()*2 + 1;
  velocity = baseVelocity;
  const segmentos = 8;
  let segment;
  do { segment = Math.floor(Math.random() * segmentos); }
  while(segment === lastSegment);
  lastSegment = segment;
  function animateSpin(){
    if(!spinning) return;
    rotation += velocity;
    velocity *= 0.985;
    if(velocity < 0.002){
      spinning = false;
      velocity = 0;
      drawRoulette();
      return;
    }
    drawRoulette();
    requestAnimationFrame(animateSpin);
  }
  animateSpin();
});

/* Boton instrucciones / modal */
const btnInstrucciones = document.getElementById('btnInstrucciones');
const modal = document.getElementById('modal');
btnInstrucciones.addEventListener('click', () => modal.style.display = 'flex');
document.getElementById('cerrar').onclick = () => modal.style.display = 'none';
window.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };

/* Boton volver */
document.getElementById('btnVolver').addEventListener('click', () => {
  window.location.href = 'index.html';
});

/* Giro manual - solo rota mientras arrastras, sin impulso al soltar */
let lastX = 0, lastRotation = 0, isDragging = false;

canvas.addEventListener('pointerdown', (e) => {
  if (spinning) return;
  isDragging = true;
  lastX = e.clientX;
  lastRotation = rotation;
  canvas.setPointerCapture(e.pointerId);
});

canvas.addEventListener('pointermove', (e) => {
  if (!isDragging) return;
  const x = e.clientX;
  const delta = (x - lastX) / 100; // sensibilidad suave
  rotation = lastRotation + delta;
  drawRoulette();
});

canvas.addEventListener('pointerup', (e) => {
  isDragging = false;
  // no impulso al soltar (según requisito)
});

/* Asegurar que el canvas se redibuje si el tamaño visual cambia (p. ej. rotate device) */
window.addEventListener('resize', () => {
  // opcional: forzamos redibujo para evitar artefactos
  drawRoulette();
});
</script>
</body>
</html>
